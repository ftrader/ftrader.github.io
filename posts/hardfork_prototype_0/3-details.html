<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>hfp0 part 3 - details</title>

<link rel="stylesheet" href="../../style.css" type="text/css" />

<link rel="stylesheet" href="../../local.css" type="text/css" />







<link rel="prev" href="./2-overview.html" title="hfp0 part 2 - overview" />

<link rel="up" href="../../posts.html" title="posts" />



<link rel="prev" href="./2-overview.html" title="hfp0 part 2 - overview" />

<link rel="up" href="./1-intro.html" title="hfp0 part 1 - intro" />



<link rel="prev" href="./2-overview.html" title="hfp0 part 2 - overview" />

<link rel="up" href="./2-overview.html" title="hfp0 part 2 - overview" />



<link rel="prev" href="./2-overview.html" title="hfp0 part 2 - overview" />

<link rel="up" href="./3-details.html" title="hfp0 part 3 - details" />


</head>
<body>

<div class="page">

<div class="pageheader">
<div class="header">
<span>
<span class="parentlinks">

<a href="../../index.html">freetrader's blog</a>/ 

<a href="../../posts.html">posts</a>/ 

<a href="../../index.html">hardfork prototype 0</a>/ 

</span>
<span class="title">
hfp0 part 3 - details

</span>
</span>

</div>






<div class="trails">
<div class="trail">

<span class="trailprev">
<span class="trailarrow">←</span>
<a href="./2-overview.html">hfp0 part 2 - overview</a>
<span class="trailsep">|</span>
</span>

<span class="trailup">
<a href="../../posts.html">posts</a>
</span>

</div>



<div class="trail">

<span class="trailprev">
<span class="trailarrow">←</span>
<a href="./2-overview.html">hfp0 part 2 - overview</a>
<span class="trailsep">|</span>
</span>

<span class="trailup">
<a href="./1-intro.html">hfp0 part 1 - intro</a>
</span>

</div>



<div class="trail">

<span class="trailprev">
<span class="trailarrow">←</span>
<a href="./2-overview.html">hfp0 part 2 - overview</a>
<span class="trailsep">|</span>
</span>

<span class="trailup">
<a href="./2-overview.html">hfp0 part 2 - overview</a>
</span>

</div>



<div class="trail">

<span class="trailprev">
<span class="trailarrow">←</span>
<a href="./2-overview.html">hfp0 part 2 - overview</a>
<span class="trailsep">|</span>
</span>

<span class="trailup">
<a href="./3-details.html">hfp0 part 3 - details</a>
</span>

</div>
</div>



</div>



<div id="pagebody">

<div id="content">


<table class="img"><caption>Space shuttle cockpit instruments</caption><tr><td><a href="../../images/space_shuttle_cockpit_instruments1.jpg"><img src="../../images/space_shuttle_cockpit_instruments1.jpg" width="384" height="216" alt="photo of space shuttle cockpit instruments" class="img" /></a></td></tr></table>


<p></p>

<h1>hardfork_prototype_0 - an early prototype of a Bitcoin hard fork</h1>

<h2>Technical Details</h2>

<p>This last part discusses aspects of the HFP0 code in more detail.</p>

<p>NOTE: This part is still under construction. Things may change.</p>

<h3>Preamble</h3>

<blockquote><p>"<em>It was a lot of fun digging into the code to figure out how to implement this fork.</em>"</p>

<p>- 'rocks' about satoshisbitcoin, in the Bitcoin Forum thread "<a href="https://bitco.in/forum/threads/announcement-bitcoin-project-to-full-fork-to-flexible-blocksizes.933/page-5#post-15421">Announcement - Bitcoin project to full fork to flexible blocksizes</a>"</p></blockquote>

<p>Before I delve into the HFP0 code, a word of thanks to rocks, who inspired me to start digging into the Bitcoin code, and the kind members at the <a href="https://bitco.in/forum">Bitcoin Forum</a> without whose patient explanations and words of encouragement I wouldn't have been able to get started on this journey. And what a fun journey it is!</p>

<p>Through it, I met a number of people who are all interested to see Bitcoin succeed, scale on-chain and fulfil the vision that Satoshi offered in the whitepaper.
I'm honored to be a part of this growing Bitcoin community, together we can overcome present obstacles and bring Bitcoin to more people in this world.</p>

<p>Before starting on this prototype, I had never looked seriously at the Bitcoin source code. I compiled it a few times, as I usually do with most software which I want to run.
Fortunately Bitcoin is free software, released under the MIT license, and no-one can really take that freedom away easily (thank you Satoshi!) As such, anyone can fork the code, at any time. It's not that difficult, so why's no-one forked Bitcoin to upgrade the block size?</p>

<p>The answer is: people have tried, by asking nicely. For several years. The most widely used implementation is now in the hands of developers who have decided that a block size upgrade is not part of their short-term roadmap, even though the network is running close to capacity. This is their right as maintainers of their implementation, but it's the right of people who disagree to produce the code changes they want to see and run them.</p>

<h3>Branches in the <code>hardfork_prototype_0</code> repository</h3>

<p>The initial HFP0 code release will be placed into a separate 'snapshot' branch named '<code>hfp0_mXXXXXX_tYYYYYYY</code>', where <code>XXXXXX</code> and <code>YYYYYYY</code> represent the mainnet and testnet trigger heights configured in the code.</p>

<p>When downloading with Git, make sure you don't select the 'develop' branch, as it only contains the historical Bitcoin code up to the commit where HFP0 development started (on March 7, 2016).
Use the <code>hfp0_m666666_t9999999</code> branch instead, e.g:</p>

<blockquote><p><code>$ git clone -b hfp0_m666666_t9999999 https://github.com/BTCfork/hardfork_prototype_0.git hfp0_m666666_t9999999</code></p></blockquote>

<p><code>hardfork_prototype_0</code> is intended to be a repository of code snapshots instead of an active development repo. Active development will take place elsewhere from now on.</p>

<p>I may yet add additional snapshot branches if I decide it is helpful to demonstrate something using this prototype.
In particular, I am experimenting with signature changes for replay attack prevention and cleaner network separation.</p>

<p>GitHub issues and pull requests for this repo may be answered, but merges will not be done in <code>hardfork_prototype_0</code> repo.</p>

<p>If someone provides a change, I will look at it, and if I deem it useful it might make it into some future snapshot.</p>

<p>If anyone wants to actively develop HFP0 further, please fork the snapshot you like and maintain it yourself.</p>

<h3>Why a single huge commit?</h3>

<p>This development was conducted privately while I was learning about the Bitcoin code, and the full commit history is long and messy.
Up to the first code release there have been 317 commits since March 7, 2016. I still maintain several unclean experimental feature branches.</p>

<p>It would take large effort to straighten it out into a series of nice, atomic functional commits. I'm not even sure that's always entirely possible with this set of changes, at least not while keeping things compiling between certain commits.</p>

<p>Therefore, instead of trying to re-arrange the commit history, I have carefully marked modifications with tagged change markers that identify the functional area(s) to which a change is associated. This has been done where possible - for some files it is not possible as they permit no comments etc.</p>

<p>The marker tags should make it relatively easy to understand what a change is about and to focus on a set of changes of interest for review.</p>

<p>I agree with those who would have preferred a clean, public development with an easily understandable commit history. I'm sorry I couldn't provide that with this first prototype.
My future work on improved spin-offs will be conducted using public repositories, and thus it should be easier to understand and review changes.</p>

<h3>Why does it change so many files?</h3>

<p>The short answer: because this is not a minimal fork.</p>

<ol>
<li><p>It includes some quite hefty external changes:</p>

<ul>
<li>modified scrypt POW from satoshisbitcoin</li>
<li>BitPay's adaptive block size</li>
<li>MIDAS per-block difficulty retargeting algorithm</li>
<li>Xtreme Thinblocks from Bitcoin Unlimited</li>
<li>retrofit of active soft-fork BIPs 65,68,112,113</li>
<li>test framework updates from Classic v1.1.0</li>
</ul>


<p>A minimum viable fork (MVF) up to 2MB which does not change the POW would likely be based on a newer client version of Core/XT/Classic/BU which already has the BIPs and necessary test framework updates included.
It would probably only need some difficulty algorithm adjustments from the list above.</p></li>
<li><p>There are large amounts of HFP0 debug traces left in the provided code, which would likely be removed for a proper release.</p></li>
</ol>


<p>I haven't worked out exactly how much is left if traces were to be removed, the new POW code discarded and only the minimal forking changes tallied.</p>

<p>It doesn't make much sense to tally that up for HFP0, because certain features are missing or not implemented to the required degree (e.g. network separation, replay attack protection) and the test coverage is incomplete.</p>

<p>However, it is obvious that a viable non-minimal spin-off client will have substantial code changes.</p>

<h3>Meaning of the change markers</h3>

<p>The following table briefly explains the meaning of the changer marker tags:</p>

<table>
<thead>
<tr>
<th> Tag </th>
<th> Meaning </th>
</tr>
</thead>
<tbody>
<tr>
<td> <code>REN</code> </td>
<td> cosmetic renames (in docs, titles, output strings, GUI menus etc.)</td>
</tr>
<tr>
<td> <code>FRK</code> </td>
<td> forking actions at triggering height</td>
</tr>
<tr>
<td> <code>DIF</code> </td>
<td> difficulty algorithm update (MIDAS)</td>
</tr>
<tr>
<td> <code>BSZ</code> </td>
<td> Adaptive block size algorithm based on BitPay implementation</td>
</tr>
<tr>
<td> <code>SED</code> </td>
<td> DNS seeds and static IPs (emptied out / dummy values)</td>
</tr>
<tr>
<td> <code>PER</code> </td>
<td> Peer handling during fork (rudimentary)</td>
</tr>
<tr>
<td> <code>CLI</code> </td>
<td> Client version update</td>
</tr>
<tr>
<td> <code>ALR</code> </td>
<td> Alert key disabling</td>
</tr>
<tr>
<td> <code>POW</code> </td>
<td> fork to new POW code (overriden by config switch --disable-newpow)</td>
</tr>
<tr>
<td> <code>XTB</code> </td>
<td> Xtreme Thinblocks implementation</td>
</tr>
<tr>
<td> <code>DBG</code> </td>
<td> fork related debugging traces (removable)</td>
</tr>
<tr>
<td> <code>CLN</code> </td>
<td> Cleanup related to removal of obsolete code</td>
</tr>
<tr>
<td> <code>TST</code> </td>
<td> Additional tests (unit, system) or fixes to tests</td>
</tr>
<tr>
<td> <code>CLT</code> </td>
<td> BIP65 OP_CHECKLOCKTIMEVERIFY</td>
</tr>
<tr>
<td> <code>RLT</code> </td>
<td> BIP68 Relative Lock-time using consensus-enforced sequence number</td>
</tr>
<tr>
<td> <code>CSV</code> </td>
<td> BIP112 CHECKSEQUENCEVERIFY</td>
</tr>
<tr>
<td> <code>MTP</code> </td>
<td> BIP113 Median time-past as endpoint for lock-time calculations</td>
</tr>
<tr>
<td> <code>TMP</code> </td>
<td> temporary settings for testing only</td>
</tr>
<tr>
<td> <code>CRY</code> </td>
<td> Cherry-picked miscellaneous fixes from other clients which otherwise trouble testing</td>
</tr>
</tbody>
</table>


<h3>Overview of file changes</h3>

<h4>List of added files (w.r.t. Classic v0.12.0cl1)</h4>

<table>
<thead>
<tr>
<th>File </th>
<th> Comment </th>
</tr>
</thead>
<tbody>
<tr>
<td><code>qa/rpc-tests/bip68-112-113-p2p.py</code> </td>
<td> BIP tests from recent upstream</td>
</tr>
<tr>
<td><code>qa/rpc-tests/bip68-sequence.py</code> </td>
<td> BIP tests from recent upstream</td>
</tr>
<tr>
<td><code>qa/rpc-tests/hardfork_bigblocks.py</code> </td>
<td> hardfork + big block test</td>
</tr>
<tr>
<td><code>qa/rpc-tests/hardfork_minebigblock.py</code> </td>
<td> hardfork + big block test</td>
</tr>
<tr>
<td><code>src/blocksizecalculator.cpp</code> </td>
<td> adaptive block size (BitPay), modified</td>
</tr>
<tr>
<td><code>src/blocksizecalculator.h</code> </td>
<td> adaptive block size (BitPay), modified</td>
</tr>
<tr>
<td><code>src/crypto/modified_scrypt_sha256.cpp</code> </td>
<td> modified scrypt (new POW)</td>
</tr>
<tr>
<td><code>src/crypto/modified_scrypt_sha256.h</code> </td>
<td> modified scrypt (new POW)</td>
</tr>
<tr>
<td><code>src/crypto/modified_scrypt_smix.cpp</code> </td>
<td> modified scrypt (new POW)</td>
</tr>
<tr>
<td><code>src/crypto/modified_scrypt_smix.h</code> </td>
<td> modified scrypt (new POW)</td>
</tr>
<tr>
<td><code>src/crypto/sysendian.h</code> </td>
<td> modified scrypt (new POW)</td>
</tr>
<tr>
<td><code>src/test/blocksizecalculator_tests.cpp</code> </td>
<td> C++ unit test for BSZ</td>
</tr>
<tr>
<td><code>src/test/thinblock_tests.cpp</code> </td>
<td> C++ unit tests for Xtreme Thinblocks</td>
</tr>
<tr>
<td><code>src/thinblock.cpp</code> </td>
<td> sources related to Xtreme Thinblocks</td>
</tr>
<tr>
<td><code>src/thinblock.h</code> </td>
<td> sources related to Xtreme Thinblocks</td>
</tr>
<tr>
<td><code>src/xthinblocks.cpp</code> </td>
<td> sources related to Xtreme Thinblocks</td>
</tr>
<tr>
<td><code>src/xthinblocks.h</code> </td>
<td> sources related to Xtreme Thinblocks</td>
</tr>
</tbody>
</table>


<h4>List of removed/replaced files</h4>

<table>
<thead>
<tr>
<th>File </th>
<th> Comment </th>
</tr>
</thead>
<tbody>
<tr>
<td><code>qa/rpc-tests/bigblocks.py</code> </td>
<td> replaced by <code>hardfork_bigblocks.py</code></td>
</tr>
<tr>
<td><code>qa/rpc-tests/forknotify.py</code> </td>
<td> removed as part of unknown-version block check removal</td>
</tr>
</tbody>
</table>


<h4>List of modified files</h4>

<table>
<thead>
<tr>
<th>File </th>
<th> Overview of significant changes </th>
</tr>
</thead>
<tbody>
<tr>
<td><code>README.md</code> </td>
<td> updated to give overview of HFP0</td>
</tr>
<tr>
<td><code>configure.ac</code> </td>
<td> client rename and support for new <code>--disable-newpow</code> configuration parameter</td>
</tr>
<tr>
<td><code>contrib/gitian-descriptors/gitian-linux.yml</code> </td>
<td> change remote URL (dummy)</td>
</tr>
<tr>
<td><code>contrib/gitian-descriptors/gitian-osx-signer.yml</code> </td>
<td> diskimages permission fix from upstream</td>
</tr>
<tr>
<td><code>contrib/seeds/nodes_main.txt</code> </td>
<td> remove public seeds, add private seeds</td>
</tr>
<tr>
<td><code>contrib/seeds/nodes_test.txt</code> </td>
<td> remove public seeds, add private seeds</td>
</tr>
<tr>
<td><code>qa/pull-tester/rpc-tests.py</code> </td>
<td> add new tests, remove forknotify.py and rename bigblocks.py</td>
</tr>
<tr>
<td><code>qa/rpc-tests/maxuploadtarget.py</code> </td>
<td> updated as per BU0.12.1bu to use maxuploadtarget of 200MB</td>
</tr>
<tr>
<td><code>qa/rpc-tests/p2p-acceptblock.py</code> </td>
<td> set correct block version after fork</td>
</tr>
<tr>
<td><code>qa/rpc-tests/p2p-fullblocktest.py</code> </td>
<td> add reminder that this test might need updating for &gt; 1MB blocks</td>
</tr>
<tr>
<td><code>qa/rpc-tests/pruning.py</code> </td>
<td> add <code>scaleblocksizeoptions=0</code></td>
</tr>
<tr>
<td><code>qa/rpc-tests/sendheaders.py</code> </td>
<td> set correct block version after fork, add XTB changes</td>
</tr>
<tr>
<td><code>qa/rpc-tests/test_framework/blockstore.py</code> </td>
<td> merged test_framework update from Classic v1.1.0</td>
</tr>
<tr>
<td><code>qa/rpc-tests/test_framework/blocktools.py</code> </td>
<td> merged test_framework update from Classic v1.1.0</td>
</tr>
<tr>
<td><code>qa/rpc-tests/test_framework/comptool.py</code> </td>
<td> merged test_framework update from Classic v1.1.0</td>
</tr>
<tr>
<td><code>qa/rpc-tests/test_framework/mininode.py</code> </td>
<td> merged test_framework update from Classic v1.1.0</td>
</tr>
<tr>
<td><code>qa/rpc-tests/test_framework/netutil.py</code> </td>
<td> merged test_framework update from Classic v1.1.0</td>
</tr>
<tr>
<td><code>qa/rpc-tests/test_framework/script.py</code> </td>
<td> merged test_framework update from Classic v1.1.0</td>
</tr>
<tr>
<td><code>qa/rpc-tests/test_framework/socks5.py</code> </td>
<td> merged test_framework update from Classic v1.1.0</td>
</tr>
<tr>
<td><code>qa/rpc-tests/test_framework/test_framework.py</code> </td>
<td> merged test_framework update from Classic v1.1.0</td>
</tr>
<tr>
<td><code>qa/rpc-tests/test_framework/util.py</code> </td>
<td> merged test_framework update from Classic v1.1.0, read in fork height triggers from C files</td>
</tr>
<tr>
<td><code>src/base58.cpp</code> </td>
<td> fix backport (cleanse full <code>vChTemp</code> vector)</td>
</tr>
<tr>
<td><code>src/bitcoin-cli.cpp</code> </td>
<td> renaming only</td>
</tr>
<tr>
<td><code>src/bitcoind.cpp</code> </td>
<td> shutdown improvements for new POW (from satoshisbitcoin), renaming</td>
</tr>
<tr>
<td><code>src/bitcoin-tx.cpp</code> </td>
<td> renaming, added TODO about signature capability once replay attack protection is implemented</td>
</tr>
<tr>
<td><code>src/chainparams.cpp</code> </td>
<td> split <code>powLimit</code> into <code>powLimitHistoric</code> and <code>powLimitResetAtFork</code>, add <code>nHFP0ActivateSizeForkHeight</code> and MIDAS parameters, dummy DNS seed, removed Classic parameters</td>
</tr>
<tr>
<td><code>src/chainparamsseeds.h</code> </td>
<td> replaced public with private seeds (generated from contrib/seeds/nodes_*.txt)</td>
</tr>
<tr>
<td><code>src/clientversion.cpp</code> </td>
<td> renamings, make scrypt/sha256 variant visible in client name</td>
</tr>
<tr>
<td><code>src/consensus/consensus.h</code> </td>
<td> add conditionals (<code>HFP0_POW</code>, <code>HFP0_DEBUG_*</code> flags), new <code>MAX_BLOCK_SIZE</code> (2MB), add fork height constants and new POW limits for mainnet/testnet/regtestnet, add static variables for adaptive block size (BSZ), remove Classic constants</td>
</tr>
<tr>
<td><code>src/consensus/params.h</code> </td>
<td> factor some MIDAS parameters out into here, add <code>powLimitHistoric</code> and <code>powLimitResetAtFork</code>, remove Classic-related majority/expiration/grace period params and access functions, add <code>nHFP0ActivateSizeForkHeight</code> variable and access function</td>
</tr>
<tr>
<td><code>src/hash.cpp</code> </td>
<td> merge <code>HashModifiedScrypt()</code> from satoshisbitcoin</td>
</tr>
<tr>
<td><code>src/hash.h</code> </td>
<td> merge <code>HashModifiedScrypt()</code> from satoshisbitcoin</td>
</tr>
<tr>
<td><code>src/init.cpp</code> </td>
<td> disable alert system, add XTB <code>debug=thin</code> argument, add BSZ <code>scaleblocksize</code> argument, renamings, BSZ update in <code>CreateNewBlock</code></td>
</tr>
<tr>
<td><code>src/main.cpp</code> </td>
<td> activate BSZ after fork trigger, XTB merges, BSZ initialize global variables, added lots of debug traces in <code>CheckTransaction</code>, BIP merges, replace <code>MAX_STANDARD_TX_SIGOPS</code> with BSZ dynamic <code>maxStandardTxSigops</code> variable, pass fork POW limit to <code>CheckProofOfWork</code> if fork blocks, replace Classic's <code>DidBlockTriggerSizeFork()</code> with <code>DidBlockTriggerHFP0SizeFork()</code>, replace <code>nMaxLegacySigops</code> by <code>maxBlockSigops</code>, ban peers which serve non-fork blocks after trigger height, merge Core PR#7919 bugfix, remove some obsolete Classic bits</td>
</tr>
<tr>
<td><code>src/main.h</code> </td>
<td> parameterize <code>MaxBlockSize()</code> and other functions with block height, add <code>UpdateAdaptiveBlockSizeVars()</code> to factor out BSZ updates. Some XTB, ALR, BIP changes.</td>
</tr>
<tr>
<td><code>src/Makefile.am</code> </td>
<td> add new files for POW, BSZ, XTB to compilation (see added files)</td>
</tr>
<tr>
<td><code>src/Makefile.test.include</code> </td>
<td> add new files for BSZ, XTB</td>
</tr>
<tr>
<td><code>src/merkleblock.cpp</code> </td>
<td> BSZ: replace <code>MAX_BLOCK_SIZE</code> constant with <code>maxBlockSize</code></td>
</tr>
<tr>
<td><code>src/miner.cpp</code> </td>
<td> FRK, BSZ and POW-related changes</td>
</tr>
<tr>
<td><code>src/miner.h</code> </td>
<td> some shutdown-related improvements from satoshisbitcoin</td>
</tr>
<tr>
<td><code>src/net.cpp</code> </td>
<td> Mostly XTB, use BSZ dynamic size instead of <code>MAX_BLOCK_SIZE</code></td>
</tr>
<tr>
<td><code>src/net.h</code> </td>
<td> XTB merge</td>
</tr>
<tr>
<td><code>src/policy/policy.cpp</code> </td>
<td> merge 4fea8e741ba38b2c1c4fb1c79962234f711c846e (use <code>MAX_STANDARD_VERSION</code> for tx version check)</td>
</tr>
<tr>
<td><code>src/policy/policy.h</code> </td>
<td> bump <code>DEFAULT_MAX_BLOCK_SIZE</code> to 1MB, BSZ: add <code>DEFAULT_SCALE_BLOCK_SIZE_OPTIONS</code>, BIPs: add <code>STANDARD_LOCKTIME_VERIFY_FLAGS</code></td>
</tr>
<tr>
<td><code>src/pow.cpp</code> </td>
<td> add MIDAS</td>
</tr>
<tr>
<td><code>src/pow.h</code> </td>
<td> add MIDAS</td>
</tr>
<tr>
<td><code>src/primitives/block.cpp</code> </td>
<td> POW: add cache of past modified scrypt hashes</td>
</tr>
<tr>
<td><code>src/primitives/block.h</code> </td>
<td> add <code>FULL_FORK_VERSION_*</code> constants, removed Classic <code>DEFAULT_2MB_VOTE</code></td>
</tr>
<tr>
<td><code>src/primitives/transaction.cpp</code> </td>
<td> BIP68 merge</td>
</tr>
<tr>
<td><code>src/primitives/transaction.h</code> </td>
<td> BIP68 and 4fea8e741ba38b2c1c4fb1c79962234f711c846e merge</td>
</tr>
<tr>
<td><code>src/protocol.cpp</code> </td>
<td> XTB merge</td>
</tr>
<tr>
<td><code>src/protocol.h</code> </td>
<td> XTB merge</td>
</tr>
<tr>
<td><code>src/qt/askpassphrasedialog.cpp</code> </td>
<td> renaming only</td>
</tr>
<tr>
<td><code>src/qt/bitcoin.cpp</code> </td>
<td> renaming only</td>
</tr>
<tr>
<td><code>src/qt/bitcoingui.cpp</code> </td>
<td> renaming only</td>
</tr>
<tr>
<td><code>src/qt/bitcoinstrings.cpp</code> </td>
<td> renaming only</td>
</tr>
<tr>
<td><code>src/qt/guiutil.cpp</code> </td>
<td> XTB add XTHIN to services</td>
</tr>
<tr>
<td><code>src/qt/intro.cpp</code> </td>
<td> renaming only</td>
</tr>
<tr>
<td><code>src/qt/rpcconsole.cpp</code> </td>
<td> renaming only</td>
</tr>
<tr>
<td><code>src/qt/splashscreen.cpp</code> </td>
<td> renaming only</td>
</tr>
<tr>
<td><code>src/qt/splashscreen.h</code> </td>
<td> renaming only</td>
</tr>
<tr>
<td><code>src/qt/utilitydialog.cpp</code> </td>
<td> renaming only</td>
</tr>
<tr>
<td><code>src/rpcblockchain.cpp</code> </td>
<td> only TODOs for more HF descriptive info</td>
</tr>
<tr>
<td><code>src/rpcmining.cpp</code> </td>
<td> FRK, DIF, BSZ changes</td>
</tr>
<tr>
<td><code>src/rpcnet.cpp</code> </td>
<td> renamings, XTB thinblockstats added</td>
</tr>
<tr>
<td><code>src/script/interpreter.cpp</code> </td>
<td> BIP112 merge</td>
</tr>
<tr>
<td><code>src/script/interpreter.h</code> </td>
<td> BIP112 merge</td>
</tr>
<tr>
<td><code>src/script/script_error.h</code> </td>
<td> BIP112 merge</td>
</tr>
<tr>
<td><code>src/script/script.h</code> </td>
<td> BIP112 merge</td>
</tr>
<tr>
<td><code>src/sync.cpp</code> </td>
<td> XTB, Classic bugfix backport (disabled <code>onlyMaybeDeadlock</code> assert due to too many false positives)</td>
</tr>
<tr>
<td><code>src/test/alert_tests.cpp</code> </td>
<td> only harmonize unit test name with filename</td>
</tr>
<tr>
<td><code>src/test/block_size_tests.cpp</code> </td>
<td> block size tests (incl. around fork height)</td>
</tr>
<tr>
<td><code>src/test/checkblock_tests.cpp</code> </td>
<td> only harmonize unit test name with filename</td>
</tr>
<tr>
<td><code>src/test/data/tx_invalid.json</code> </td>
<td> BIP112 merge</td>
</tr>
<tr>
<td><code>src/test/data/tx_valid.json</code> </td>
<td> BIP112 merge</td>
</tr>
<tr>
<td><code>src/test/miner_tests.cpp</code> </td>
<td> complex inherited BIP68 test changes. File marked as changed by BIP68, individual changes not marked separately.</td>
</tr>
<tr>
<td><code>src/test/prevector_tests.cpp</code> </td>
<td> only harmonize unit test name with filename</td>
</tr>
<tr>
<td><code>src/test/script_tests.cpp</code> </td>
<td> BIP68 merge</td>
</tr>
<tr>
<td><code>src/test/test_bitcoin.cpp</code> </td>
<td> reset BSZ global vars between tests, BIP112 merge</td>
</tr>
<tr>
<td><code>src/test/test_bitcoin.h</code> </td>
<td> BIP112 merge</td>
</tr>
<tr>
<td><code>src/test/transaction_tests.cpp</code> </td>
<td> BIP112 merge</td>
</tr>
<tr>
<td><code>src/test/txvalidationcache_tests.cpp</code> </td>
<td> only harmonize unit test name with filename</td>
</tr>
<tr>
<td><code>src/timedata.cpp</code> </td>
<td> renaming only</td>
</tr>
<tr>
<td><code>src/txdb.cpp</code> </td>
<td> DIF: use appropriate POW limit</td>
</tr>
<tr>
<td><code>src/txdb.h</code> </td>
<td> XTB merge</td>
</tr>
<tr>
<td><code>src/txmempool.cpp</code> </td>
<td> BIP68, BIP112 merge</td>
</tr>
<tr>
<td><code>src/txmempool.h</code> </td>
<td> BIP112 merge</td>
</tr>
<tr>
<td><code>src/univalue/include/univalue.h</code> </td>
<td> XTB merge</td>
</tr>
<tr>
<td><code>src/version.h</code> </td>
<td> split <code>PROTOCOL_VERSION</code> into <code>POW_PROTOCOL_VERSION</code> and <code>SHA_PROTOCOL_VERSION</code></td>
</tr>
</tbody>
</table>


<h4>List of modified files without recognizable change markers</h4>

<p>The following is a list of files which didn't permit adding formal change markers.</p>

<table>
<thead>
<tr>
<th>File </th>
<th> Comment </th>
</tr>
</thead>
<tbody>
<tr>
<td><code>contrib/gitian-descriptors/gitian-linux.yml</code> </td>
<td> YAML data, change is simply a deflected URL</td>
</tr>
<tr>
<td><code>src/test/data/tx_invalid.json</code> </td>
<td> JSON data, merge from CSV BIP</td>
</tr>
<tr>
<td><code>src/test/data/tx_valid.json</code> </td>
<td> JSON data, merge from CVS BIP</td>
</tr>
<tr>
<td><code>contrib/seeds/nodes_main.txt</code> </td>
<td> list of addresses processed by another script</td>
</tr>
<tr>
<td><code>contrib/seeds/nodes_test.txt</code> </td>
<td> list of addresses processed by another script</td>
</tr>
</tbody>
</table>


<p>There are also some Python files in <code>qa/rpc-tests/test_framework</code> which have been
updated based on the Classic v1.1.0 code. In these files, not every Classic-related
change is marked - the files are marked generally with a single-line <code>TST</code> marker comment
underneath the file header:</p>

<blockquote><p><code># HFP0 TST: merged test_framework update from Classic v1.1.0</code></p></blockquote>

<h3>Building</h3>

<p>Build instructions for Classic 0.12.0 should work fine. Platforms I've compiled and tested on:</p>

<ul>
<li><p>Debian 7 (x86_64 and i686), gcc 4.7.2</p></li>
<li><p>Debian 8 (x86_64), gcc 4.9.2</p></li>
</ul>


<p>HFP0 adds a new configuration option: <code>--disable-newpow</code> .</p>

<p>Unless you specify this option, the client is built to switch to the new POW at the trigger height.</p>

<p>If you specify <code>--disable-newpow</code>, the fork keeps using Bitcoin's existing SHA256 after it triggers.</p>

<h3>Test Status</h3>

<p>What follows is a brief overview - I might update this with more detail later on.</p>

<p>I have tested this prototype only in an isolated test environment (using up to 4 VMs).
Most of my testing was done using regtestnet, the regression test chain.
It has NOT been tested on the real testnet or on mainnet.</p>

<p>The C++ unit tests (<code>src/test/test_bitcoin</code>) should all pass.
You will see a message on standard output:</p>

<blockquote><p><code>CreateAndProcessBlock: ProcessNewBlock, block not accepted</code></p></blockquote>

<p>I added this message as a troubleshooting aid to see when a block was not accepted.
It does not signify a test failure, and can be ignored.</p>

<p>Regression/integration tests can be run with <code>qa/pull-tester/rpc-tests.py</code> .</p>

<p>The tests <code>bip68-sequence.py</code> and <code>pruning.py</code> currently fail.
For bip68-sequence, it is presumed to be a policy code issue
that has been fixed in later versions of other clients (a similar issue
was present on Classic 0.12 builds, but has been fixed in Classic 1.1).
I have not identified the exact change that could fix it, but the
test failure is likely unrelated to changes made by HFP0.</p>

<p>The pruning test failure might be due to a presumed bug in how the
fork handles re-orgs across its trigger, but it could also be
something else.</p>

<p>Rudimentary hardfork / bigger block QA tests are implemented,
but they are lacking in some test cases
(re-orgs across the fork trigger height, and fine-grained
testing around the trigger height).
They also specify a soft block limit of 2MB, and don't exercise the
theoretical maximum of even that soft limit. A more complete test should
try to test up to MAX_BLOCK_SIZE without a soft block limit.
This involves a substantial overhaul of the big block tests.</p>

<p>Adaptive block size tests are limited to the <code>blocksizecalculator_tests</code>
suite, and would need to be extended with more test cases and integration
tests.</p>

<p>There are no unit tests / regression tests for MIDAS yet.</p>

<p>I welcome any feedback from others who are able try out this prototype in their own test environments or on the actual testnet.</p>

<h3>Further development</h3>

<p>I will not develop this HFP0 prototype further to production readiness.</p>

<p>I consider it more important that Minimum Viable Forks are produced, with solid test coverage and requirements input from the wider community.</p>

<p>The BTCfork community (links below) is doing just that, working with users,
developers and businesses in the Bitcoin space to develop improved
forks, starting from MVFs and later hopefully supporting the development
of fuller-featured fork candidates.  I shall be working with them to bring viable forks to maturity.</p>

<p>If you want to get involved, you are welcome to get in touch on any of the channels below.</p>

<ul>
<li>Slack: sign up here: <a href="https://btcforks.signup.team/">https://btcforks.signup.team/</a></li>
<li>Reddit: <a href="https://www.reddit.com/r/btcfork/">https://www.reddit.com/r/btcfork/</a></li>
<li>GitHub: <a href="https://github.com/BTCfork">https://github.com/BTCfork</a></li>
<li>ConsiderIt (issue voting): <a href="https://btcfork.consider.it/">https://btcfork.consider.it/</a></li>
<li>Twitter: <a href="https://twitter.com/btcfork">https://twitter.com/btcfork</a></li>
</ul>


<hr />

<h3>Feedback on the code</h3>

<p>If you wish to provide feedback on the code, feel free to use GitHub's comment features or
raise issues.</p>

<p>I won't fix issues directly in the <code>hardfork_prototype_0</code> repository,
but I may include fixes in future code snapshot, if any take place on this repo,
and I'll try to respond to any sensible comments there.</p>

<p>Alternatively, I've opened a Reddit thread in <a href="https://www.reddit.com/r/btcfork">/r/btcfork</a> to gather comments and questions.</p>

</div>





</div>

<div id="footer" class="pagefooter">

<div id="pageinfo">


<div class="trails">
<div class="trail">

<span class="trailprev">
<span class="trailarrow">←</span>
<a href="./2-overview.html">hfp0 part 2 - overview</a>
<span class="trailsep">|</span>
</span>

<span class="trailup">
<a href="../../posts.html">posts</a>
</span>

</div>



<div class="trail">

<span class="trailprev">
<span class="trailarrow">←</span>
<a href="./2-overview.html">hfp0 part 2 - overview</a>
<span class="trailsep">|</span>
</span>

<span class="trailup">
<a href="./1-intro.html">hfp0 part 1 - intro</a>
</span>

</div>



<div class="trail">

<span class="trailprev">
<span class="trailarrow">←</span>
<a href="./2-overview.html">hfp0 part 2 - overview</a>
<span class="trailsep">|</span>
</span>

<span class="trailup">
<a href="./2-overview.html">hfp0 part 2 - overview</a>
</span>

</div>



<div class="trail">

<span class="trailprev">
<span class="trailarrow">←</span>
<a href="./2-overview.html">hfp0 part 2 - overview</a>
<span class="trailsep">|</span>
</span>

<span class="trailup">
<a href="./3-details.html">hfp0 part 3 - details</a>
</span>

</div>
</div>




<div class="tags">
Tags:

<a href="../../tags/BTCfork.html" rel="tag">BTCfork</a>

<a href="../../tags/Bitcoin.html" rel="tag">Bitcoin</a>

<a href="../../tags/HFP0.html" rel="tag">HFP0</a>

<a href="../../tags/fork.html" rel="tag">fork</a>

</div>



<div id="backlinks">
Links:

<a href="./1-intro.html">1-intro</a>


</div>






<div class="pagedate">
Last edited <span class="date">Thu 22 Sep 2016 09:22:44 CEST</span>
<!-- Created <span class="date">Wed 21 Sep 2016 10:00:00 CEST</span> -->
</div>

</div>


<!-- from freetrader's blog -->
</div>

</div>

</body>
</html>
