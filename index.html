<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>freetrader's blog</title>

<link rel="stylesheet" href="style.css" type="text/css" />

<link rel="stylesheet" href="local.css" type="text/css" />






</head>
<body>

<div class="page">

<div class="pageheader">
<div class="header">
<span>
<span class="parentlinks">

</span>
<span class="title">
freetrader's blog

</span>
</span>

</div>








</div>


<div class="sidebar">


<div><div class="calendar"><table class="month-calendar">
    <tr>
    <th class="month-calendar-arrow"></th>
    <th class="month-calendar-head" colspan="5">June 2017</th>
    <th class="month-calendar-arrow"></th>
    </tr>
    <tr>
        <th class="month-calendar-day-head Sunday" title="Sunday">S</th>
        <th class="month-calendar-day-head Monday" title="Monday">M</th>
        <th class="month-calendar-day-head Tuesday" title="Tuesday">T</th>
        <th class="month-calendar-day-head Wednesday" title="Wednesday">W</th>
        <th class="month-calendar-day-head Thursday" title="Thursday">T</th>
        <th class="month-calendar-day-head Friday" title="Friday">F</th>
        <th class="month-calendar-day-head Saturday" title="Saturday">S</th>
    </tr>
    <tr>
        <td class="month-calendar-day-noday Sunday">&nbsp;</td>
        <td class="month-calendar-day-noday Monday">&nbsp;</td>
        <td class="month-calendar-day-noday Tuesday">&nbsp;</td>
        <td class="month-calendar-day-noday Wednesday">&nbsp;</td>
        <td class="month-calendar-day-nolink Thursday">1</td>
        <td class="month-calendar-day-nolink Friday">2</td>
        <td class="month-calendar-day-nolink Saturday">3</td>
    </tr>
    <tr>
        <td class="month-calendar-day-link Sunday"><a href="./posts/weekly_musings/20170604-weekly-musing-009-1.html" title="20170604-weekly-musing-009-1">4</a></td>
        <td class="month-calendar-day-nolink Monday">5</td>
        <td class="month-calendar-day-nolink Tuesday">6</td>
        <td class="month-calendar-day-nolink Wednesday">7</td>
        <td class="month-calendar-day-nolink Thursday">8</td>
        <td class="month-calendar-day-nolink Friday">9</td>
        <td class="month-calendar-day-nolink Saturday">10</td>
    </tr>
    <tr>
        <td class="month-calendar-day-link Sunday"><a href="./posts/weekly_musings/20170611-weekly-musing-010-1.html" title="20170611-weekly-musing-010-1">11</a></td>
        <td class="month-calendar-day-nolink Monday">12</td>
        <td class="month-calendar-day-nolink Tuesday">13</td>
        <td class="month-calendar-day-nolink Wednesday">14</td>
        <td class="month-calendar-day-nolink Thursday">15</td>
        <td class="month-calendar-day-nolink Friday">16</td>
        <td class="month-calendar-day-nolink Saturday">17</td>
    </tr>
    <tr>
        <td class="month-calendar-day-link Sunday"><a href="./posts/weekly_musings/20170618-weekly-musing-011-1.html" title="20170618-weekly-musing-011-1">18</a></td>
        <td class="month-calendar-day-nolink Monday">19</td>
        <td class="month-calendar-day-nolink Tuesday">20</td>
        <td class="month-calendar-day-nolink Wednesday">21</td>
        <td class="month-calendar-day-nolink Thursday">22</td>
        <td class="month-calendar-day-nolink Friday">23</td>
        <td class="month-calendar-day-nolink Saturday">24</td>
    </tr>
    <tr>
        <td class="month-calendar-day-this-day Sunday"><a href="./posts/weekly_musings/20170625-weekly-musing-012-1.html" title="20170625-weekly-musing-012-1">25</a></td>
        <td class="month-calendar-day-future Monday">26</td>
        <td class="month-calendar-day-nolink Tuesday">27</td>
        <td class="month-calendar-day-nolink Wednesday">28</td>
        <td class="month-calendar-day-nolink Thursday">29</td>
        <td class="month-calendar-day-nolink Friday">30</td>
        <td class="month-calendar-day-noday Saturday">&nbsp;</td>
    </tr>
</table>
</div></div>


<p><a href="./archives.html">Archives</a></p>

<p><a href="./tags.html">Tags</a>:</p>

<ul class="list">
<li><span class="smallestPC"><a href="./tags/BTCfork.html">BTCfork</a></span>
</li><li><span class="biggestPC"><a href="./tags/Bitcoin.html">Bitcoin</a></span>
</li><li><span class="smallestPC"><a href="./tags/HFP0.html">HFP0</a></span>
</li><li><span class="smallestPC"><a href="./tags/fork.html">fork</a></span>
</li><li><span class="bigPC"><a href="./tags/musings.html">musings</a></span>
</li><li><span class="smallestPC"><a href="./tags/personal.html">personal</a></span>
</li><li><span class="bigPC"><a href="./tags/weekly.html">weekly</a></span>
</li></ul>




</div>


<div id="pagebody">

<div id="content">


<div  class="feedlink">


</div>
<div class="inlinepage">

<div class="inlineheader">

<span class="header">

<a href="./posts/weekly_musings/20170625-weekly-musing-012-1.html">freetrader&#x27;s weekly musings - volume 12</a>

</span>
</div>

<div class="inlinecontent">
<h1>Weekly musing #12 - Gearing up for release</h1>

<h2>Final touches on ABC</h2>

<p><a href="https://github.com/bitcoinabc/bitcoinabc">Bitcoin ABC</a> is a modified version of Bitcoin Core with a user-configurable
maximum blocksize, i.e. an Adjustable Blocksize Cap (hence "ABC").</p>

<p>It is based on Core 0.14.1, and implements the <a href="https://github.com/Bitcoin-UAHF/spec/uahf-technical-spec.md">UAHF specification</a>.
The source code and development can be found at https://reviews.bitcoinabc.org .</p>

<p>We've been very busy getting this to near release so far.
There are a few minor finishing touches remaining on the code, but it's almost feature complete.</p>

<p>In a follow-up post I'd like to do a walk-through post of the changes at some stage, but this requires reformatting the baseline (the Core 0.14.1 commit where ABC branched off) so that we can cleanly compare what was built on top.</p>

<p>The difference looks bigger than it really is in terms of code changes, because nearly the entire codebase has been put through clang-format to clean up the source code.
This obscures the significant functional changes to an extent.
A <code>git diff --stat</code> shows 508 changed files so far - that includes files that were newly added (e.g. ABC tests) and files that were removed (e.g. those related purely to SegWit).</p>

<p>Re-formatting the baseline 0.14.1 with the same style rules to get a clean comparison requires some touch-ups.
This is because some sections in ABC were protected from clang-format's modifications.
There are also manual formatting actions to improve layouting of comments, although these are easy to ignore.
Overall, there were 337 commits since development on top of Core commit 964a185cc began.</p>

<p>It could be helpful to mark the functional changes related to UAHF with their respective requirements.</p>

<h2>Test framework issues</h2>

<p>We have identified what is likely an issue with the Python test framework's handling of peer messages.</p>

<p>During tests with large blocks, the test framework's mininode may run into buffering problems on the received data, which often leads to test failure.
This only seems to happen towards the end of one big-block test at the moment, and there is a workaround to reduces the chance of this happening.</p>

<p>However, it is very likely that we need to re-work the test framework's message buffering and processing if we want to be able to do very-large-block tests.</p>

<p>Perhaps this played a role in previous tests where we struggled to test &gt; 16MB blocks.</p>

<p>On testnet3, the forked client has produced blocks over 15MB already which were well received by its peers.</p>

</div>

<div class="inlinefooter">

<span class="pagedate">
Posted <span class="date">Sun 25 Jun 2017 23:55:00 CEST</span>
</span>


<span class="tags">
Tags:

<a href="./tags/Bitcoin.html" rel="tag">Bitcoin</a>

<a href="./tags/musings.html" rel="tag">musings</a>

<a href="./tags/weekly.html" rel="tag">weekly</a>

</span>








</div>

</div>
<div class="inlinepage">

<div class="inlineheader">

<span class="header">

<a href="./posts/weekly_musings/20170618-weekly-musing-011-1.html">freetrader&#x27;s weekly musings - volume 11</a>

</span>
</div>

<div class="inlinecontent">
<h1>Weekly musing #11 - Homework</h1>

<table class="img"><caption>Bitcoin Core learns about an Adjustable Blocksize Cap</caption><tr><td><a href="./images/chalkboard1-abc-small.jpg"><img src="./images/chalkboard1-abc-small.jpg" width="504" height="334" alt="Bitcoin Core learns about an Adjustable Blocksize Cap" class="img" /></a></td></tr></table>


<h2>Bitcoin ABC</h2>

<p>Work is progressing towards the Bitcoin ABC implementation.
Already it was able to digest blocks slightly larger than 8MB on BU's no-limits testnet.
In regression tests, sizes up to 16MB have not posed a problem.</p>

<p>Scaling Bitcoin Core may not be as simple as adjusting a single constant, but ABC proves it can be done.</p>

<h2>UAHF</h2>

<p>The release of the UAHF contingency plan [3] and the accompanying technical specification [4] marked a decisive answer to the threat posed to Bitcoin's security by BIP-148 (UASF).</p>

<p>ABC adaptations for the counter HF to the upcoming UASF are in an advanced stage and expected to be ready for validation soon.</p>

<h2>Bitcoin Unlimited</h2>

<p>BU is working on a UAHF-compatible specification [5]. It is provisionally called 'BUIP-HF'.
Development is going to be channeled through the 'buip-hf' branch on my Github repository,
from where I will feed Pull Requests back to BU.</p>

<p>A <a href="https://github.com/ftrader-bitcoinunlimited/BitcoinUnlimited/blob/buip-hf/doc/buip-hf.md">guidance document</a> has been created for contributing BU developers.</p>

<p>Preparations are also underway for another point release of BU prior to a major release later this year which should bring most of the 'dev' branch changes over to 'release'.</p>

<h2>BTCfork MVF</h2>

<p>I'm considering adapting the SegWit trigger condition of the MVF's to take into account the planned SegWit2x activation conditions (which seem to have swung in favor of BIP-91 now).
Still to be decided, but my stance is unchanged - in the event of SegWit activating on the main chain, there should be a spin-off to provide a SegWit-free alternative.
This could be UAHF, but since that is planned to activate some hours after UASF, it could make sense to activate an earlier spin-off at the same time as UASF.</p>

<h2>References</h2>

<p>[1] Image of blackboard derived from https://commons.wikimedia.org/w/index.php?curid=36633029 <br>
by Raysonho @ Open Grid Scheduler / Grid Engine - own work, CC0</p>

<p>[2] Image of academic with square cap derived from https://commons.wikimedia.org/w/index.php?curid=14939026 <br>
by Gardner Cotrell Leonard - “Academic Costume.” in A Cyclopedia of Education, edited by Paul Monroe, 17, New York: The Macmillan Company, 1911., Public Domain</p>

<p>[3] <a href="https://blog.bitmain.com/en/uahf-contingency-plan-uasf-bip148/">UAHF: A contingency plan against UASF (BIP148)</a></p>

<p>[4] <a href="https://github.com/Bitcoin-UAHF/spec/uahf-technical-spec.md">UAHF Technical Specification</a></p>

<p>[5] <a href="https://github.com/BitcoinUnlimited/BUIP/blob/master/BUIP-HF/uahf-technical-spec.md">BUIP-HF Technical Specification</a></p>

</div>

<div class="inlinefooter">

<span class="pagedate">
Posted <span class="date">Sun 18 Jun 2017 23:40:00 CEST</span>
</span>


<span class="tags">
Tags:

<a href="./tags/Bitcoin.html" rel="tag">Bitcoin</a>

<a href="./tags/musings.html" rel="tag">musings</a>

<a href="./tags/weekly.html" rel="tag">weekly</a>

</span>








</div>

</div>
<div class="inlinepage">

<div class="inlineheader">

<span class="header">

<a href="./posts/weekly_musings/20170611-weekly-musing-010-1.html">freetrader&#x27;s weekly musings - volume 10</a>

</span>
</div>

<div class="inlinecontent">
<h1>Weekly musing #10 - Learning the ABC's</h1>

<h2>Bitcoin ABC</h2>

<p>Bitcoin ABC - short for Adjustable Blocksize Cap , is a big-block capable
client based on Core 0.14.1 that is progressing in development and gaining
more contributors and code reviewers.</p>

<p>Parts of the main functionality (being able to adjust the block size cap through a
configuration option) have now been implemented for the command line client.
Others remain to be added, for example being able to display its accepted block size
limit in the well-known /EBx/ format used by BU and Classic.</p>

<p>A version of ABC should be out for testing in the next few weeks!</p>

<h2>Bitcoin Unlimited</h2>

<p>A specification for a hard fork release along the lines of BUIP 055 is taking shape.
I have had the pleasure of collaborating with various developers and stakeholders
in drafting this, and it is nearing completion.</p>

<p>Many refinements have been made over BUIP 055.</p>

<p>For example, there is provision for bi-drectional replay protection, and protection
against re-organization by the legacy chain.</p>

<h2>BTCfork</h2>

<p>With a wide variety of projects rallying around the idea of a near-term HF,
elements of BTCfork's MVF may come in useful for implementors of other clients.</p>

<p>In particular, clients targeted at end users might benefit from the automatic wallet
backup functionality written by redmarlen (a fellow BU developer too).
This could be integrated into other fork clients quiet easily.</p>

</div>

<div class="inlinefooter">

<span class="pagedate">
Posted <span class="date">Sun 11 Jun 2017 23:32:00 CEST</span>
</span>


<span class="tags">
Tags:

<a href="./tags/Bitcoin.html" rel="tag">Bitcoin</a>

<a href="./tags/musings.html" rel="tag">musings</a>

<a href="./tags/weekly.html" rel="tag">weekly</a>

</span>








</div>

</div>
<div class="inlinepage">

<div class="inlineheader">

<span class="header">

<a href="./posts/weekly_musings/20170604-weekly-musing-009-1.html">freetrader&#x27;s weekly musings - volume 9</a>

</span>
</div>

<div class="inlinecontent">
<h1>Weekly musing #9 - The freedom to choose your own cap</h1>

<table class="img"><caption>UASF? Asics, baby.</caption><tr><td><a href="./images/H9fnhTG-hashpower_matters.png"><img src="./images/H9fnhTG-hashpower_matters.png" width="617" height="676" alt="UASF? Asics, baby." class="img" /></a></td></tr></table>


<h2>Bitcoin Unlimited</h2>

<p>Voting is over, and the results for this round of BUIPs and new member applications is in.
Congratulations to the new members!
The new system was quite pleasant to use. I hope it will continue to get improvements.
One that most of us would probably like is batched voting, so one doesn't have to sign for every issue individually.</p>

<p>To those applicants who did not get in this time, I hope you will apply again and participate in the meantime!
Some clearly did not make it in because existing members abstained or voted in low numbers, which troubles me a little.
I think 21/49 voter turnout is not that great - certainly room for improvement.</p>

<h3>Improvement Proposals</h3>

<p>On the BUIP side, I am happy that BU has passed the BUIP026 to offer <a href="https://bitco.in/forum/threads/buip026-passed-bounties-for-software-exploits.1970/">bounties for exploitable bugs</a>.</p>

<p>CompactBlocks were accepted by a nice majority, so they will become reality in BU!
This should lead to bandwidth savings all around.
With BU's network code undergoing big refactorings on the development branch, it will be a bit of a challenge to develop, but nothing insurmountable. Existing tests from Core and XT can hopefully be re-used with minor adaptations.</p>

<p>I'm also excited about BUIP052 - this should get the project a separate Continuous Integration service for daily tests of the whole test suite. BU contributor awemany has been investigating fuzz testing, which would be a good thing to include on such daily tests.</p>

<p>A bit disappointing is that BUIP053 and BUIP054 did not reach quorum, and had to be closed despite quite solid majorities in favor of these proposals. It was just not enough this time around.</p>

<p>BUIP053 (Tweakable DoS responses) in particular is one I had high hopes for in terms of moving us away from a relatively static and inflexible scoring/banning design, towards something that places more power in the hands of users and reduces the impact of (potentially bad) developer decisions.</p>

<p>Also great news is that both BUIP055 (hard fork in near future) and BUIP056 (support-threshold triggered block size increases) were passed. The first one indicates that membership clearly recognizes the urgent need to act in offering a definite hard fork to the market, especially in light of the threat of UASF.
BUIP056 appears a good way to reach consensus within the EB signaling framework pioneered by BU but which is being adopted by other clients such as Classic and hopefully more in future.</p>

<p>BUIP057 (BIP135 support) could be useful for future upgrade deployments, due to its flexibility in configuring activation thresholds and grace periods for proposed forking changes (whether soft or hard).</p>

<h3>Nolnet reboot</h3>

<p>Initial testing on BU's rebooted Nolnet (no-limits testnet) suggests there could still be issues related to unwanted node banning during block header synchronisation.</p>

<p>But the rebooted parameters of the network will ensure that Nolnet addresses are different from ordinary Bitcoin addresses, and so avoid possible mistakes that could result in some financial loss.
Nolnet will also reset to minimum difficulty now, so that locking out testers by raising the difficulty to a very high value will not be possible so easily (at least, not for long periods).</p>

<h2>BTCfork</h2>

<p>The new Nolnet settings need to be integrated into MVFs, as I plan to have the MVF's be able to participate in fork tests, also w.r.t. BUIP055.</p>

<p>I found an embarrasing bit shifting bug in the replay protection code. Thanks go to Tom Harding for inspiring me to look over it again.
Funny how one can get inspired to look carefully at one's code when someone else is interested in it too <img src="./smileys/smile.png" alt=":-)" /></p>

<p>Another small change that seemed prudent, was to bypass the MVF's adjusted difficulty retargeting code if the user specified that the difficulty was not to be reset at the fork activation. So now, if diffdrop=1, only the old difficulty code path is used.
I had not really thought much about minority forks which want to keep the difficulty the same, but if there are such, then it's better to carry on running the existing code.</p>

<h2>Bitcoin ABC</h2>

<p>Still working on the ABC functionality - have been mostly reviewing changes by the project lead.</p>

<h2>References</h2>

<p>[1] Image of Asics cap: public domain (CC0) by freetrader <a href="mailto:freetrader@tuta.io">&#x66;&#x72;&#101;&#x65;&#116;&#x72;&#x61;&#100;&#x65;&#114;&#x40;&#116;&#117;&#x74;&#97;&#x2e;&#105;&#111;</a> <br></p>

</div>

<div class="inlinefooter">

<span class="pagedate">
Posted <span class="date">Sun 04 Jun 2017 23:59:00 CEST</span>
</span>


<span class="tags">
Tags:

<a href="./tags/Bitcoin.html" rel="tag">Bitcoin</a>

<a href="./tags/musings.html" rel="tag">musings</a>

<a href="./tags/weekly.html" rel="tag">weekly</a>

</span>








</div>

</div>
<div class="inlinepage">

<div class="inlineheader">

<span class="header">

<a href="./posts/weekly_musings/20170528-weekly-musing-008-1.html">freetrader&#x27;s weekly musings - volume 8</a>

</span>
</div>

<div class="inlinecontent">
<h1>Weekly musing #8 - Keep calm and fork</h1>

<table class="img align-right"><caption>Fork at Vevey, Lake Geneva</caption><tr><td><a href="./images/vevey-2104986_540.jpg"><img src="./images/vevey-2104986_540.jpg" width="540" height="720" alt="Fork at Vevey, Lake Geneva" class="img" /></a></td></tr></table>


<h2>BTCfork</h2>

<p>A rebase on very recent BU <code>dev</code> branch has been completed.</p>

<p>I learned the painful lesson that it is much easier just to merge in the changes from upstream as opposed to actually rebasing (in Git's sense) all the MVF work, which would necessitate a forced push on MVF-BU's <code>master</code> (default) branch. That would be disruptive to those who have checkouts of MVF-BU (not many, I suppose, but it would be bad practice).</p>

<p>Thinking about requirements for a <a href="https://np.reddit.com/r/btcfork/comments/6cn7ye/the_silbert_accord_and_its_implications/">UASF counter-fork</a> to UASF will see me adding a few requirements to the MVFs.</p>

<p>One of them is probably time-based forking - in order to fork exactly on an unknown block height which corresponds to the median time activation criterion of BIP148 or similar proposals. This would make MVFs capable of forking on either block height OR a chosen time, whichever comes first.</p>

<p>One could set the block height to a very high value if one did not want to use it, to let the time-based forking take precedence.</p>

<p>I've held off on implementing time-based forking up to now since it comes with a few more complications.
The client cannot tell for certain when the final pre-fork block has been received, and this makes things like changing to the new consensus rules and performing wallet backups harder. But it seems that flag day forks like UASF require a forking trigger in MVF to be able to fork at exactly the same time, so as to create the least difference between the fork blockchain and the legacy chain.</p>

<p>A rebase of MVF-Core is still outstanding. The objective will be to rebase on Core 0.14 minus SegWit/RBF, but with Adjustable Blocksize Cap.</p>

<h2>Bitcoin Unlimited</h2>

<p>Apart from reviews and minor fixes to some extended tests, I've uploaded my eligible BUIPs for the coming voting round.</p>

<p>I am keen to see the new voting system in action, although it is becoming clear that it will need a bit of handholding by its creator for the first session. This is of course normal. So far, I like what I've seen!
There are some areas that may need small improvement in future, e.g. in management of unpublished proposals, and dealing with users who have lost their keys and need to revoke them. The latter part may be a bit tricky! I would recommend BU users to always keep a separate PGP key for BU signing purposes, so that they could use that to revoke the Bitcoin key in a pinch.</p>

<h2>References</h2>

<p>[1] Image of Vevey fork in Lake Geneva derived from public domain (CC0) work: <br>
https://pixabay.com/en/vevey-lake-fork-switzerland-museum-2104986/</p>

</div>

<div class="inlinefooter">

<span class="pagedate">
Posted <span class="date">Sun 28 May 2017 23:45:00 CEST</span>
</span>


<span class="tags">
Tags:

<a href="./tags/Bitcoin.html" rel="tag">Bitcoin</a>

<a href="./tags/musings.html" rel="tag">musings</a>

<a href="./tags/weekly.html" rel="tag">weekly</a>

</span>








</div>

</div>
<div class="inlinepage">

<div class="inlineheader">

<span class="header">

<a href="./posts/weekly_musings/20170521-weekly-musing-007-1.html">freetrader&#x27;s weekly musings - volume 7</a>

</span>
</div>

<div class="inlinecontent">
<h1>Weekly musing #7 - User Activated System Failure?</h1>

<p>It will be interesting to watch as UASF activates on August 1.</p>

<p>Bitcoin should be a robust protocol on <a href="https://en.wikipedia.org/wiki/Layer_8">layers 8 and above</a> <img src="./smileys/smile.png" alt=":-)" /></p>

<h2>Bitcoin Unlimited</h2>

<p>Hopefully kyuupichan's port of the Classic parameter fixes makes it into BU soon.
After reviewing it, I like it a lot - the changes should make BU safer to operate.
It did show however, that a single reviewer does not catch everything - I missed a reference to 'Bitcoin Classic'!</p>

<p>As the time approaches for another exciting round of votes in BU, I have added two BUIPs which I feel can help:</p>

<ul>
<li><a href="https://bitco.in/forum/threads/buip058-dynamic-checkpoints.2135/">BUIP058</a> (dynamic checkpoints)</li>
<li><a href="https://bitco.in/forum/threads/buip059-make-sticky-gate-optional-disabled-by-default.2137/">BUIP059</a> (make sticky gate optional)</li>
</ul>


<h3>Dynamic checkpoints</h3>

<p>This would offer a general way to address re-org risk when a transition from one blocksize Schelling point to another happens.
Currently of course we face the 1MB barrier, but maybe in the (far?) future we face a 32MB barrier etc.</p>

<p>Eventually, dynamic checkpoints could be created when certain conditions on the chain are met (case in point: when the first &gt;1MB block is generated).</p>

<p>Short term, they could offer some resistance against massive re-orgs caused by an attacker.
One could conceivably add regular (automated) dynamic checkpointing (e.g. every day, replace the most recent dynamic checkpoint with a new block that is at least a week deep).</p>

<h3>Make "sticky gate" optional</h3>

<p>In retrospective, I think BUIP038 may have lost support because it did not offer users the choice of running with the "sticky gate" feature.
It could also have been bad luck / apathy during that particular voting cycle.
Not everyone feels able to vote on such technical issues - this is also part of the problem with increasing complexity - which is what I think may have also killed the counter-proposal, BUIP041.</p>

<p>One thing remains clear: the "sticky gate" was successfully exploited on social media to paint BU in a negative light, using the speculated "median EB attack" which hopes to divide the network by producing a series of larger blocks. Having the feature disabled by default would make BU's "Emergent Consensus" default logic slightly easier to grasp, and would also make it harder to attack in the proposed way.</p>

<h2>Bitcoin-ABC</h2>

<p>I've created the "dirty" implementation of a <a href="https://github.com/ftrader-bitcoinabc/bitcoin-abc/commits/feature/2mb_test-dirty">2MB-capable Core</a>, albeit it does scale block max sigops correctly yet (it allows up to 40K sigops per block instead of scaling at 20K per MB).
It does however pass the existing test suite.</p>

<p>I've not pushed my private ABC branch yet, as there is still work to be done on it.</p>

<h2>BTCfork</h2>

<p>I am planning to rebase on latest BU dev again. It would be good to test out dynamic checkpointing in a feature branch of an up-to-date MVF-BU.</p>

</div>

<div class="inlinefooter">

<span class="pagedate">
Posted <span class="date">Sun 21 May 2017 23:50:00 CEST</span>
</span>


<span class="tags">
Tags:

<a href="./tags/Bitcoin.html" rel="tag">Bitcoin</a>

<a href="./tags/musings.html" rel="tag">musings</a>

<a href="./tags/weekly.html" rel="tag">weekly</a>

</span>








</div>

</div>
<div class="inlinepage">

<div class="inlineheader">

<span class="header">

<a href="./posts/weekly_musings/20170514-weekly-musing-006-1.html">freetrader&#x27;s weekly musings - volume 6</a>

</span>
</div>

<div class="inlinecontent">
<h1>Weekly musing #6 - And up again...</h1>

<table class="img"><caption>Roly Poly Toys</caption><tr><td><a href="./images/rolypolytoys-grey.png"><img src="./images/rolypolytoys-grey.png" width="553" height="229" alt="Roly Poly Toys" class="img" /></a></td></tr></table>


<h2>Bitcoin Unlimited</h2>

<h3>v1.0.2.0 release (fix for 2nd memory exhaustion incident)</h3>

<p>Another release (1.0.2.0), fixing another Xthin exploitable bug similar to the previous memory exhaustion issue.
Again, the problem and a workaround were quickly identified. Having <code>use-thinblocks=0</code> disables Xthin more effectively since 1.0.1.4 - fortunately that worked and probably protected quite a few nodes. Still, having 1/3 of the BU nodes killed again obviously shakes confidence.</p>

<p>A lot of fixes were brought together for the 1.0.2.0 release, which made it take longer.
Good things take time, but bad code can waste a lot of time. I guess BU is paying the price for changing p2p protocol code without sufficient review and testing in the early days.
While some of the easily exploited holes have now been closed, there are some worries remaining, like the risk of someone producing relatively cheap collisions, or the memory limit while reconstructing thinblocks being perhaps a little higher than needed.</p>

<p>Still, my feeling is BU is getting more robust with each attack. However, recovery was a little more protracted with this one, as it tool longer for the official binaries to be released.
Source code fixes were available in PR form quite early on.</p>

<p>There was however again a percentage of users who probably will not come back to BU because of this incident. Classic seems to have made some small gains (not visible on chart below).</p>

<table class="img"><caption>nodecounter.com recent Bitcoin Unlimited nodes statistics</caption><tr><td><a href="./images/20170514_bu_nodes_nodecounter_recent.png"><img src="./images/20170514_bu_nodes_nodecounter_recent.png" width="1125" height="387" alt="nodecounter.com recent Bitcoin Unlimited nodes statistics" class="img" /></a></td></tr></table>


<p>With the aid of a little script from thezerg, I managed to get my BU gitian build working for this release, and was thus able to sign the 1.0.2.0 checksums.
I think I will need to abandon my gitian build VM though, it seems just to slow compared to others.</p>

<h3>pruning.py problems not local to BU</h3>

<p>After getting such poor pass rates on the pruning test, I executed it on Classic and Core latest builds as well.</p>

<p>On Classic, it went into a loop, which I stopped after several hours.</p>

<p>On Core, it timed out as well. I raised <a href="https://github.com/bitcoin/bitcoin/issues/10393">Github issue 10393</a> which has yet to receive a response.</p>

<h3>Miscellaneous</h3>

<p>I opened an issue for the <a href="https://github.com/BitcoinUnlimited/BitcoinUnlimited/issues/557">overly verbose keypool traces</a> in the log file.
These have been bugging myself and others - they often lead to questions whether something is wrong.
I have not decided which debug flag to use for them.</p>

<h3>BUIPs</h3>

<p>There are some interesting coordination-related proposals which have been raised on the forum (in Draft BUIP form):</p>

<ul>
<li>Peter Rizun's <a href="https://bitco.in/forum/threads/buip055-increase-the-block-size-limit-at-a-fixed-block-height.2103/">BUIP055</a></li>
<li>Tomas van der Wansem's <a href="https://bitco.in/forum/threads/increase-the-block-size-limit-triggered-by-a-support-threshold.2111/">threshold-based BUIP</a> (no number yet)</li>
<li>Sancho Panza's <a href="https://bitco.in/forum/threads/buipxxx-add-bip135-support-bip9.2114/">BUIP to add BIP135</a></li>
</ul>


<p>I'm looking forward to the upcoming voting - I will raise BUIP038 too since it did not get quorum the time before last, and I think that it should be put to the vote now that membership and participation have increased. I am undecided on whether to make it into a new BUIP with a toggle to enable the sticky gate instead of just removing it as BUIP038 proposed. If anyone has strong feelings about that, I'd like to hear about them!</p>

<h2>Bitcoin-ABC</h2>

<p>The failing regression tests have been sorted out - ABC is now passing its Travis tests.</p>

<ul>
<li><a href="https://github.com/Bitcoin-ABC/bitcoin-abc/pull/1">Removed SegWit regression tests</a></li>
<li><a href="https://github.com/Bitcoin-ABC/bitcoin-abc/pull/2">Fixed p2p-compactblocks.py</a></li>
<li><a href="https://github.com/Bitcoin-ABC/bitcoin-abc/pull/4">Fixed wallet transaction check which failed lots of regtests</a></li>
<li><a href="https://github.com/Bitcoin-ABC/bitcoin-abc/pull/5">Removed leftover bumpfee code</a></li>
<li><a href="https://github.com/Bitcoin-ABC/bitcoin-abc/pull/11">Removed replace-by-fee.py</a></li>
<li><a href="https://github.com/Bitcoin-ABC/bitcoin-abc/pull/15">Fixed maxuploadtarget.py</a></li>
</ul>


<p>While looking at fixing the failing nulldummy.py test, I <a href="https://github.com/Bitcoin-ABC/bitcoin-abc/pull/6">considered</a> removing the NULLDUMMY support entirely.
It is a soft-fork which is actually functionally separate from SegWit, but deployed on the same bit!
This is a bit unorthodox, but on the mailing list Johnson Lau defended this with the reason that it would reduce testing effort for SegWit not to handle it as an independent soft-fork.</p>

<p>After raising <a href="https://github.com/Bitcoin-ABC/bitcoin-abc/issues/3">an issue</a> to decide on the right course of action, I discussed it with deadalnix, who was in favor of retaining it for now.</p>

<p>I have created an ABC branch (on my personal fork repo) where I have executed a more aggressive removal of this currently unused feature and its test. I will be cherry-picking from the mainline ABC repo, trying to keep it clean of features which are not yet present or needed in today's Bitcoin Core, and focusing only on the basic blocksize scaling part.</p>

<p>As part of resolving the failing tests, I did 10 runs of the '-extended' regression test suite, excluding the 'pruning' test which takes too long.
The results were interesting - not all tests are passing reliably on my (old) system.
Times are in seconds, and only the times of passes are counted for mean/stdev statistics.</p>

<table class="img"><caption>Extended regression test status over 10 runs on Bitcoin-ABC</caption><tr><td><a href="./images/20170513_abc-initial-test-overview.png"><img src="./images/20170513_abc-initial-test-overview.png" width="731" height="1377" alt="Extended regression test status over 10 runs on Bitcoin-ABC" class="img" /></a></td></tr></table>


<p>The next step will be adding a true Adjustable Blocksize Cap. This will be where the fun really starts!</p>

<p>If anyone is interested in assisting with the ABC effort, contact us or submit PRs / issues directly on Github!</p>

<h2>parity-unlimited</h2>

<p>There is some more developer interest for giving parity support for bigger blocks.  Personally, I did not find time to continue test experiments with parity-bitcoin or parity-unlimited, but it's been nice to chat with other people on the BU slack about it.</p>

</div>

<div class="inlinefooter">

<span class="pagedate">
Posted <span class="date">Sun 14 May 2017 23:00:00 CEST</span>
</span>


<span class="tags">
Tags:

<a href="./tags/Bitcoin.html" rel="tag">Bitcoin</a>

<a href="./tags/musings.html" rel="tag">musings</a>

<a href="./tags/weekly.html" rel="tag">weekly</a>

</span>








</div>

</div>
<div class="inlinepage">

<div class="inlineheader">

<span class="header">

<a href="./posts/weekly_musings/20170507-weekly-musing-005-1.html">freetrader&#x27;s weekly musings - volume 5</a>

</span>
</div>

<div class="inlinecontent">
<h1>Weekly musing #5 - Testing, Testing, ...</h1>

<table class="img"><caption>Fixing problems</caption><tr><td><a href="./images/fixing_problems.png"><img src="./images/fixing_problems.png" width="312" height="307" alt="Fixing problems" class="img" /></a></td></tr></table>


<h2>Bitcoin Unlimited</h2>

<p>I've been testing and raising issues on Github for some failing
tests that we are troubleshooting. (I guess it <a href="https://github.com/BitcoinUnlimited/BitcoinUnlimited/issues/476">started</a>
with the failing <code>pruning.py</code>, but we encountered more
during recent updates meant to close some post-1.0.1.4 gaps.</p>

<p>Among them:</p>

<ul>
<li><a href="https://github.com/BitcoinUnlimited/BitcoinUnlimited/issues/513">p2p-acceptblock</a></li>
<li><a href="https://github.com/BitcoinUnlimited/BitcoinUnlimited/issues/537">abandonconflict</a></li>
</ul>


<p>I tested another one with sickpig (<a href="https://github.com/BitcoinUnlimited/BitcoinUnlimited/issues/518">validateblocktemplate</a>).</p>

<p>Most if not all these test failures were apparently random failures,
some involving infinite loops.</p>

<p>Random failures can slip through Travis CI undetected, only to surface later.
This seems to have already happened, based on subsequent investigations.</p>

<p>This is a prime reason to run the <em>full</em> test suite (including extended
tests) multiple times a day, on as many platforms as possible.
Fortunately BU's Travis account has been upgraded to a paid one,
at least this means the project will be able to run more tests.</p>

<h3>Running tests repeatedly</h3>

<p>Our parallel testing wrapper for unit tests has an <code>-r</code> option for
repeating tests, but our regression test wrapper (rpc-tests.py) currently
does not. This is something I'd like to enhance, it is frequently needed
because a lot of failures are not deterministic.</p>

<p>One can of course always write a little shell script.
I used this one which runs the test repeatedly using a timeout per run,
logs failures to a temporary file and prints out the total number of
failures at the bottom.</p>

<pre><code>#!/bin/bash
TIMEOUT=100 # seconds, need to adapt to specific test
TEST_COMMAND="qa/pull-tester/rpc-tests.py abandonconflict"
for i in {1..100}
do 
   echo "`date`: start iteration $i"
   timeout --foreground $TIMEOUT $TEST_COMMAND || echo "this is a failure"
   killall bitcoind
done | tee /tmp/testfailures.log | grep -c "this is a failure"
</code></pre>

<p>Messy, but it works.</p>

<p>Hopefully, an improved rpc-tests.py will do this for us in future,
and spit out more statistics e.g. average time per run and maybe the
standard deviation of that.</p>

<h3>Bisections</h3>

<p>Once you know a test is failing randomly on a certain revision, you
need to find out what introduced the problem.</p>

<p>If you cannot tell easily, then you can usually get some idea by testing
backwards from a known bad commit (usually the head of the branch you are working off)
to find the first commit that broke the test, and see what it changed.</p>

<p>If the source of the problem possibly lies back a long time, going back
over each revision takes a long time. You can try doing a <a href="https://wiki.ubuntu.com/Kernel/KernelBisection">bisection</a>
which is much quicker (but you need to know a working revision sometime in the past).</p>

<p>I submitted a PR for a helper script that can be used in conjunction
with <code>git bisect</code> to run a bisection on a test that is failing
randomly and/or getting stuck in a loop.</p>

<p>I committed the <a href="https://github.com/ftrader/bitcoin-misc-contrib/blob/master/bisection-tools/bisect_probabilistic_with_timeout.sh">original version</a>
of this script in my personal repo under GPLv3, but I submitted it
in improved form in <a href="https://github.com/BitcoinUnlimited/BitcoinUnlimited/pull/532">PR532</a>.
That PR introduces an additional documentation file with some tips in <code>doc/bug-triage.md</code>.</p>

<p>The script has so far proved quite useful, but it does have limitations,
for example when the build breaks in some past commits. Be sure to read
the file header of the script and the mentioned document if you plan to
use it.</p>

<p>The main benefit is that this script can triage randomly failing and looping tests.
It can be used in "one-shot" mode without running a bisection, of course,
just to either</p>

<ul>
<li>run a test command repeatedly (set a huge timeout if you know the test does not time out)</li>
<li>catch a test which times out (although you can also use the timeout(1) command in Linux)</li>
</ul>


<h2>parity-bitcoin</h2>

<p>I've never dabbled in Rust before, so I was surprised that it was not too
difficult to get to a running version of <a href="https://github.com/paritytech/parity-bitcoin">parity-bitcoin</a>.
Fortunately I did have a little help though from Christian Nyumbayire
(Chritchens on the forum and Reddit). He is working on an adaptation of
Parity that he called 'parity-unlimited' and is currently taking shape.
Initial steps will hopefully demonstrate that parity can handle a hardcoded
bigger block size (e.g. 2MB) well.</p>

<p>Here is his announcement thread, in which he also left valuable information
on how to install Parity (some information on installing dependencies got me
past initial hurdles).</p>

<p>https://bitco.in/forum/threads/multi-implementation-client-development.2092/</p>

<p>I was able to successfully run the unmodified parity-bitcoin unit test suite (one
test was ignored but all others passed).
Unfortunately, my initial attempt to run the regression test suite failed -
it got stuck with bitcoinj receiving an empty block header.</p>

<p>Whether this was a problem with my build (I did not build the 'release' build)
or still a bug in the regression tests is something that future trials will
show.</p>

<p>It is already promising that it got very far in the regression tests.
Hopefully it can soon become a big-block capable neighbor of Bitcoin Unlimited
on the actual network.</p>

<h2>BTCfork</h2>

<p>I managed to resolve the little issues that were troubling Travis, and
so complete the merge of recent upstream BU 'dev' into <a href="https://github.com/BTCfork/hardfork_prototype_1_mvf-bu">MVF-BU</a>.</p>

<p>Two long running tests (excessive.py and parallel.py) had to be moved to the
'extended' set of tests which are not automatically run.
This is because BTCfork still operates on a free Travis instance with a
cutoff time of 50 minutes.</p>

<p>The fork code introduces some long-running tests of its own, and these have
to be tested more frequently. However, when touching code that modifies
block handling, it will be necessary to manually run the relocated tests,
and occasionally swap them into Travis for testing across different
build platforms (which I don't have).</p>

<p>I will be starting work on a checkpoint feature next, but more details
about that once it is ready.</p>

<h2>Bitcoin-ABC</h2>

<p>BU contributor deadalnix created a repository of a Bitcoin Core 0.14 client
which has the SegWit and RBF removed.</p>

<p>This can serve as a basis for future Adjustable Blocksize Cap modification,
hence he called it: <a href="https://github.com/Bitcoin-ABC/bitcoin-abc">Bitcoin-ABC</a>!</p>

<p>I have started assisting on this effort by helping to resolve some failing
regression tests.  Most of the issues appear due to incomplete removal
of SegWit test code, and should not take too long to clean up.</p>

<p>It would be exciting to have a recent Core with a configurable limit!
Any volunteers are more than welcome to assist this effort.</p>

<h4>Footnotes</h4>

<p><a name="footnote1">[1]</a> Fixings Problems comic thanks to https://xkcd.com/1739/ (CC BY-NC 2.5)</p>

</div>

<div class="inlinefooter">

<span class="pagedate">
Posted <span class="date">Sun 07 May 2017 22:22:00 CEST</span>
</span>


<span class="tags">
Tags:

<a href="./tags/Bitcoin.html" rel="tag">Bitcoin</a>

<a href="./tags/musings.html" rel="tag">musings</a>

<a href="./tags/weekly.html" rel="tag">weekly</a>

</span>








</div>

</div>
<div class="inlinepage">

<div class="inlineheader">

<span class="header">

<a href="./posts/weekly_musings/20170430-weekly-musing-004-1.html">freetrader&#x27;s weekly musings - volume 4</a>

</span>
</div>

<div class="inlinecontent">
<h1>Weekly musing #4 - Labor Day 2017</h1>

<table class="img"><caption>1900's Labor Day parade, Toronto, Canada</caption><tr><td><a href="./images/1900s_Toronto_LabourDay_Parade-45pct.jpg"><img src="./images/1900s_Toronto_LabourDay_Parade-45pct.jpg" width="473" height="335" alt="1900&#39;s Labor Day parade, Toronto, Canada" class="img" /></a></td></tr></table>


<h2>Bitcoin Unlimited</h2>

<p>Quite a week!  Too much excitement!</p>

<h3>Memory Exhaustion attack, BU release 1.0.1.4</h3>

<p>What began as a gradual decline of BU nodes on the network turned into the sharp decline on 24 April.</p>

<p>Cross-checking with others on Slack and examination of logs followed.
An initial diagnosis of the attack was soon made, as fortunately BU developer Peter Tschipper had already been working on a thinblocks patch that was believed to mitigate this kind of attack.
His patch turned out to be effective, and provided a good first line of defense to the BU network.
Nodes were upgraded within hours, and the patch was reviewed and improved for several hours until it was deemed fit for including in a release.</p>

<p>I will leave an account of the further details to the official BU Incident Report.</p>

<p>By way of this incident, I had opportunity to revisit my Gitian build machine, as I wanted to check if I could participate in verifying the formal release build.
I reconfigured a VM that I had previously set up for doing a Gitian build of other projects (Classic, BTCfork).
This VM had given me some trouble with Gitian builds of Classic, where it produced binaries with different checksums.
I took this chance to see if a similar problem would occur when trying to do a Gitian build for BU.</p>

<p>With instructions provided by Andrea Suisani, I was able to reproduce the Linux release build results.
Unfortunately I noticed that my VM is very slow in comparison to the fast builders used by others.
So in the time it took them to build all platforms, I only managed to build the Linux binaries.
A contributing factor may have been that it was the first time I did the BU build on there, and it had to build all the dependencies first.
Maybe next time will be quicker.</p>

<p>Of course, if you're going for a faster build, you may want to set up the host system on a native machine, and not bother with a separate VM.
Maybe in a while I'll get a faster machine for these kind of builds and tests.</p>

<p>I'm going to provide a link to the <a href="https://github.com/BitcoinUnlimited/BitcoinUnlimited/blob/release/doc/gitian-building.md">instructions on how to set up a VM or physical system</a> for Bitcoin, and pass on the additional instructions provided to me specifically for BU:</p>

<pre><code>sudo apt-get install git apt-cacher-ng python-vm-builder ruby qemu-utils
git clone https://github.com/BitcoinUnlimited/BitcoinUnlimited.git BU
cd BU
git checkout release
cd ..
git clone git@github.com:devrandom/gitian-builder.git
cd gitian-builder
./bin/make-base-vm --arch amd64 --suite trusty    # this need to be done only once
# for the --commit flag you need to set a branch or a tag.
# You could use also --num-make #JOBS and --memory MEM (memory to allocate in MiB)
./bin/gbuild --url bitcoin=https://github.com/BitcoinUnlimited/BitcoinUnlimited.git --commit bitcoin=release ../BU/contrib/gitian-descriptors/gitian-linux.yml
</code></pre>

<p>Hopefully these will help someone else achieve a working Gitian build too.
BU needs more people who can do Gitian builds, so that it can respond quickly with hotfix releases.</p>

<h3>Testing for unwanted XthinBlocks code execution</h3>

<p>After it became clear that the vulnerability exploited by the attack was again in thinblocks code, I made a check to gain confidence that BU's <code>--use-thinblocks=0</code> switch was effective.
I instrumented the code with some assert(0) statements as many relevant thinblocks code sections as I could find. These would force a crash if those sections were entered.
This is an easy check that anyone can do for a new feature.
It does not require in-depth understanding of how the feature works - just find all references and apply some common sense while booby-trapping the code.</p>

<p>I found one case where thinblocks code was still executed as part of Xpedited functionality even though I had configured <code>use-thinblocks=0</code> on my node.
This was reported and fixed by Peter Tschipper's pull request <a href="https://github.com/BitcoinUnlimited/BitcoinUnlimited/pull/486/">486</a></p>

<p>There was general agreement that Xpedited, which depends on thinblocks, should not be enabled if thinblocks is disabled.</p>

<p><em>Personally, I would prefer if every new major feature had a clear switch to turn it on/off.
Even if features are good and useful, I would consider it safer to deploy it with new features disables by default until those features have been tested for a sufficient time, and then set the default to be activated.
On a software development level, this is more effort, but it makes it much easier for most users to get back to a safe operation if there is a problem with the new feature.
Power users may have the ability to run multiple versions of the software at once, but this is probably not the case for the majority of users.
Maybe like Gavin Andresen said, we need to get to know our customers a little more.
It should be sufficient to raise a PR (or a BUIP if want to force a vote on the issue) to change the default on/off setting for a feature, then members can vote and the non-member public can also give their opinions to the discussion.</em></p>

<table class="img align-right"><caption>An arborist pruning a tree <br>
                near Statue of Liberty, New York.</caption><tr><td><a href="./images/Arborist_pruning_Statue_of_Liberty.jpg"><img src="./images/Arborist_pruning_Statue_of_Liberty.jpg" width="250" height="358" alt="An arborist pruning a tree near Statue of Liberty, New York." class="img" /></a></td></tr></table>


<h3>Pruning</h3>

<p>The pruning feature introduced in Bitcoin Core 0.11 was designed with 1MB blocks in mind,
and needs some adaptation for bigger blocks.
I raised <a href="https://github.com/BitcoinUnlimited/BitcoinUnlimited/issues/473">issue 473</a> to address this.
It will be needed once we obtain bigger blocks, otherwise pruned nodes on machines with strictly limited space might run over their configured soft limits or even hit hard quotas / run out of disk space completely.</p>

<p>In the PR, I propose a fix that would involve making the minimum number of blocks to retain a configuration item, while keeping the existing <code>prune=&lt;size&gt;</code> parameter.
The user would be warned in case of the pruned size being exceeded, and could choose between keeping less blocks, or increasing the space for pruning.</p>

<p>Jameson Lopp kindly <a href="https://github.com/BitcoinUnlimited/BitcoinUnlimited/issues/478">pointed out</a> a related consideration - that the AD parameter could influence the minimum number of blocks to be retained in order to be able to perform a re-organization safely.</p>

<p>To start development, I experimented with the <code>pruning.py</code> regression test.
Unfortunately, I found this test, which is normally disabled due to its long runtime and high disk usage (&gt;4GB), to be highly unreliable and afflicted by problems.
It did not pass on the <code>release</code> branch without rolling back to a certain commit, and on the <code>dev</code> branch it went into an endless loop (confirmed by other testers too).</p>

<p>The endless loop behavior led me to open a feature request for loop detection and abort in the test framework (<a href="https://github.com/BitcoinUnlimited/BitcoinUnlimited/issues/480">PR 480</a>).</p>

<p>I opened a separate issue to <a href="https://github.com/BitcoinUnlimited/BitcoinUnlimited/issues/476">collect data</a> about the pruning test status for various environments.
Several contributors assisted with testing. The issue is still being progressed - so far I found one environment where the test passed (if rolled back to a 'healthy' commit).
It seems that there are issues related to the p2p networking which may be interfering and causing client bans and timeouts.
The work on the pruning test definitely involves fixes to the client, and I'm working closely with other developers on that.</p>

<h3>Log privacy considerations</h3>

<p>A Github user raised an issue about <a href="https://github.com/BitcoinUnlimited/BitcoinUnlimited/issues/472">privacy concerns to do with IP address logging</a> in the BU client.
This is definitely a consideration close to my heart.</p>

<p>Usually the <code>logips=0</code> option should prevent any unnecessary output of IP addresses in the log file and debug console.
What exactly constitutes a need to override this, if at all - this is a question.</p>

<p>Most error messages provide very little information if the network information is not included.
Traditionally these seem to be unprotected by the <code>logips</code> flag.</p>

<p>There are, however, error instances such as 'BAN THRESHOLD EXCEEDED' messages where IP logging should definitely be applied only if requested.</p>

<p>I wonder if it is not simpler to apply the policy that if <code>logips=0</code>, then definitely do not log an IP address.
We may need to output a special abbreviated trace in such cases, if the notification is still important.</p>

<h3>To ban or not to ban (peers)</h3>

<p>In the followup to the memory exhaustion attack, Gregory Maxwell raised Issue 485 on the BU Github:</p>

<p><a href="https://github.com/BitcoinUnlimited/BitcoinUnlimited/issues/485">Short-id collisions allow attackers to cause arbritary bans of thinblock peers</a></p>

<p>Subsequent discussions on BU Slack highlighted a need for further improvements to the thinblock subsystem.
I think BU has a good handle on the issues, and is more aware now that improvements in this area have to be made and assessed very carefully.</p>

<p>One point that is becoming clearer:</p>

<p>If this is left up to the developer to decide, the response can range from "ignore" to "ban immediately", with variations on gradual banning in-between those extremes.
And choosing a too harsh penalty (e.g. immediate ban) can result in <a href="https://github.com/BitcoinUnlimited/BitcoinUnlimited/issues/477">further problems</a>.</p>

<p>While it would be great to have a consistent policy that software developers could apply to solve every problem around misbehaving peers, I think that is wishful thinking, because attackers are very creative, and the network is anyway a constantly changing sea.</p>

<p>The key lies, I think, in viewing this as policy and giving the node operators the necessary tools to defend their nodes, by making the response more configurable.</p>

<p>I think we should make all Denial-of-Service defense responses tweakable, and have a user menu (and RPC interface) for adjusting them.</p>

<p>Of course, developers still need to think about what a sensible response level for a new protective measure would be.
But they could deliver a parameter file with all the defaults, and let the user easily override the configuration to suit their needs.</p>

<p>If a response is found unsuitable, there is no need to immediately issue a corrective software release - it would be sufficient to publish an advisory notice recommending to change a certain parameter in response to a network threat.</p>

<h3>The 1MB fork transaction</h3>

<p>Last Sunday, someone (/u/1MBforKTR1gAqRLkNbQg) posted a <a href="https://www.reddit.com/r/btc/comments/6747e2/1mb_fork_txn/">very interesting thread</a> on Reddit which contained a link to a very large transaction which, if mined, would create a block &gt; 1MB and thereby create a chain fork.</p>

<p>This proposal soon turned up as a <a href="https://github.com/BitcoinUnlimited/BitcoinUnlimited/issues/464">change request</a> to BU to allow such transactions to be pushed (p2p) over the network.
On the same day, it was also submitted to Core, who <a href="https://github.com/bitcoin/bitcoin/pull/10266">rejected it without much discussion</a>.</p>

<p>I replied to the BU issue and PR, stating why I did not think such a change was needed (a miner wishing to create a &gt; 1MB fork chain could mine the transaction already).
However, I was open to arguing the case for/against it.</p>

<p>For some reason, the poster who raised the issue did not respond with more rationale on BU's issue tracker after my enquiry.
I was a little disappointed to find a <a href="https://www.reddit.com/r/btc/comments/68d4r1/1mb_txn_update/">Reddit update post</a> from them which stated that 'No one else reached out'.
We did reach out and try to discuss their pull request!</p>

<p>Unfortunately, we have little discussion on the PR so far, with everyone attending to other urgent matters.
I presume this will result in the issue being closed if the poster does not engage further.</p>

<p>As was also pointed out, the poster holds the keys to funds donated to that the addresses in that transaction.
I like the improvements suggested by /u/edmundedgar in <a href="https://www.reddit.com/r/btc/comments/6747e2/1mb_fork_txn/dgnvgss/">this comment thread</a> on the original proposal:</p>

<p>In my opinion, the ability for separate coins by using the 'faucet' feature of this transaction is one of the interesting aspects of this proposal.
Perhaps something like this can be leveraged by an exchange or miner willing to produce such a block.
I would definitely be more relaxed about the keys for such a transaction being in known hands.</p>

<h3>The road to CompactBlocks</h3>

<p>This week's other issues left no time for me to start deeper investigation of CompactBlocks.
Other devs have expressed interest in an experimental branch for it, and there is positive support expressed for it in <a href="https://bitco.in/forum/threads/buip051-add-compactblocks-support.2017/">BUIP051</a>. This makes me optimistic that it can be put up for vote and perhaps even reach agreement for implementation.</p>

<h2>BTCfork</h2>

<p>After the recent merge from upstream BU 'dev' branch, there were some minor leftover issues manifesting as test failures.
These were mainly related to build system changes and <a href="http://python3porting.com/differences.html">moving from Python2 to Python3</a>.
Those have been fixed, and happily upstream BU did not break any of the fork-related functionality - all tests pass.
Fortunately we did have good unit tests in the <code>arith.py</code> module, which helped when troubleshooting an integer division problem which broke the mvf-bu-retarget.py test (wrong expected difficulty after reset).
The problem turned out to be in the helper procedure that emulates the C++ difficulty adjustment algorithm.
On Python3 scripts need to use floor division (//) otherwise a floating point division will be performed.
This resulted in a slightly different difficulty value, and for a while I was worried that the upstream merge might have subtly changed something about the fork trigger and resulting difficulty reset.</p>

<p>A remaining problem now is that one Travis test fails because it checks the code formatting (using clang-format).
This currently fails for some of the code which MVF modified, so those source files will need to be reformatted.
I'm hoping to get around to that in a day or two, as soon as I have a native clang-format on my old development box.
I've decided to build LLVM / Clang from source on there. I was shocked to find that the LLVM+clang(+extra tools) build took up 40GB of disk space, and at times I had to reduce the number of parallel build threads to just one because my memory was being exhausted by the build! I think I would recommend just installing clang through your package manager <img src="./smileys/smile.png" alt=":-)" /></p>

<p>Before I merge from upstream again, I'll await some stabilization on BU's 'dev' branch after the recent memory exhaustion attack fixes.
There is still much work ongoing to polish those fixes and make BU's custom thinblock and expedited code as robust as possible.</p>

<h4>Footnotes</h4>

<p><a name="footnote1">[1]</a> Labor Day image in Public Domain via Wikimedia Commons<br>
https://commons.wikimedia.org/wiki/File%3A1900s_Toronto_LabourDay_Parade.jpg</p>

<p><a name="footnote2">[2]</a> Pruning image in Public Domain via Wikimedia Commons <br>
Photo under license of National Park Service, United States Government, Frederick Law Olmsted National Historic Site. <br>
https://commons.wikimedia.org/wiki/File%3AArborist_pruning_Statue_of_Liberty.jpg</p>

</div>

<div class="inlinefooter">

<span class="pagedate">
Posted <span class="date">Sun 30 Apr 2017 22:00:00 CEST</span>
</span>


<span class="tags">
Tags:

<a href="./tags/Bitcoin.html" rel="tag">Bitcoin</a>

<a href="./tags/musings.html" rel="tag">musings</a>

<a href="./tags/weekly.html" rel="tag">weekly</a>

</span>








</div>

</div>
<div class="inlinepage">

<div class="inlineheader">

<span class="header">

<a href="./posts/weekly_musings/20170423-weekly-musing-003-1.html">freetrader&#x27;s weekly musings - volume 3</a>

</span>
</div>

<div class="inlinecontent">
<h1>Weekly musing #3 - Mr Bitcoin is hungry</h1>

<table class="img"><caption>Japanese Silky Tofu
       <br>
       (Kinugoshi Tofu) [1]</caption><tr><td><a href="./images/kinugoshi_tofu-no-fork.png"><img src="./posts/weekly_musings/20170423-weekly-musing-003-1/180x241-kinugoshi_tofu-no-fork.png" width="180" height="154" alt="Japanese Silky Tofu" class="img" /></a></td></tr></table>


<h2>Bitcoin Unlimited</h2>

<p>I raised <a href="https://bitco.in/forum/threads/buip051-add-compactblocks-support.2017/">BUIP051</a>, am going to take a close look at porting those changes over from XT during the coming week or two.</p>

<p>Happily, the proposal to spend some money for a better (paid) Travis build service has met with a supportive reception at BU, so I think we are soon going to have the possibility to run longer test suites (up to 120 minutes each - maybe need to break the test suite down into several batches which individually fit in under 2 hrs, or just execute randomly and time out just below 2 hrs).</p>

<p>Parallel execution of regression tests might be helpful. I'm planning to add that feature to BU's rpc-tests.py (Core has had that feature <a href="https://github.com/bitcoin/bitcoin/commit/fa494dec79b9d469b7eb38d2f0b8cf9832cdc398">for a while</a>).</p>

<p>Until then, I've <a href="https://github.com/BitcoinUnlimited/BitcoinUnlimited/pull/463">pull-requested some minor test runner improvements</a> I made in MVF-BU, to allow execution of single tests with specific arguments, and allow one-off test runs of disabled tests. This should make it a little easier for testers to run disabled tests - now they don't have to edit the rpc-tests.py script code to temporarily enable a test.</p>

<p>Some nice changes from Classic have been <a href="https://github.com/BitcoinUnlimited/BitcoinUnlimited/pull/460">ported to BU by kyuupichan</a>: the improved command line parameter handling which prevents invalid parameters from being silently ignored at startup.</p>

<h2>BTCfork</h2>

<p>Finally got around to merging the latest Bitcoin Unlimited dev branch changes back into MVF-BU. Turned out to be something like 1200+ commits - who said BU isn't developmentally active? <img src="./smileys/smile4.png" alt=";-)" /></p>

<p>Unfortunately, Travis is not yet completely happy with my merge - it seems some build environment changes or file movements have broken the test framework.
My own 32-bit test system also needs to upgrade to a C++11 compiler to handle the upstream compiler requirement changes.
All in all, these seems like minor things that can be cleaned up fairly quickly - over the course of the next few days.
After that, MVF-BU will be back on track for further development.</p>

<h2>Extension blocks or bigger regular blocks</h2>

<p>After Gregory Maxwell's recent post on bitcoin-dev, the clamor for UASF SegWit seems to have died down a bit - maybe it's just on the back burner.</p>

<p>Bitcoin Unlimited seems to be within good reach of regular big blocks.</p>

<p><a href="https://github.com/tothemoon-org/extension-blocks/blob/master/spec.md">Extension Blocks</a> looks like another promising idea, but quite a complex undertaking in comparison to straightforward big blocks.</p>

<p>Maybe Mr Bitcoin will place an order for both, and see which one the kitchen can deliver first?</p>

<h4>Footnotes</h4>

<p><a name="footnote1">[1]</a> Original Japanese Silky Tofu image by DryPot (CC-BY-SA-3.0) at <br>
<a href="https://en.wikipedia.org/wiki/Tofu#/media/File:Japanese_SilkyTofu_%28Kinugoshi_Tofu%29.JPG">https://en.wikipedia.org/wiki/Tofu#/media/File:Japanese_SilkyTofu_%28Kinugoshi_Tofu%29.JPG</a>&gt;</p>

</div>

<div class="inlinefooter">

<span class="pagedate">
Posted <span class="date">Sun 23 Apr 2017 20:00:00 CEST</span>
</span>


<span class="tags">
Tags:

<a href="./tags/Bitcoin.html" rel="tag">Bitcoin</a>

<a href="./tags/musings.html" rel="tag">musings</a>

<a href="./tags/weekly.html" rel="tag">weekly</a>

</span>








</div>

</div>



<p>This blog is powered by <a href="http://ikiwiki.info">ikiwiki</a>.</p>

</div>





</div>

<div id="footer" class="pagefooter">

<div id="pageinfo">







<div id="backlinks">
Links:

<a href="./posts.html">posts</a>


</div>






<div class="pagedate">
Last edited <span class="date">Mon 19 Sep 2016 10:43:01 CEST</span>
<!-- Created <span class="date">Mon 09 May 2016 23:39:24 CEST</span> -->
</div>

</div>


<!-- from freetrader's blog -->
</div>

</div>

</body>
</html>
